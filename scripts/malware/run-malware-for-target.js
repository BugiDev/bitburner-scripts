import {walkWholeNetwork} from "/scripts/util/network";
import {CONFIG} from "/scripts/config";

/** @param {NS} ns */
export async function main(ns) {
    const targetName = ns.args[0];
    const debug = ns.args[1] || false;

    await walkWholeNetwork(ns, (ns, serverName, debug) => runMalware(ns, serverName, targetName, debug), debug);
}


function runMalware(ns, serverName, targetName, debug) {
    const serverMaxRAM = ns.getServerMaxRam(serverName);
    const scriptRAM = ns.getScriptRam(CONFIG.malwareFile);
    const threadCount = Math.floor(serverMaxRAM / scriptRAM);

    if (threadCount > 0) {
        ns.exec(CONFIG.malwareFile, serverName, threadCount, targetName, threadCount);
    }
}

