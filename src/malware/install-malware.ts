import { NS } from '@ns';
import { CONFIG } from '/config';
import { log } from '/util/log';
import { validateServerName } from '/util/validation';

export async function main(ns: NS) {
  const serverName = ns.args[0] as string;
  const debug = (ns.args[1] || false) as boolean;

  validateServerName(serverName);
  installMalware(ns, serverName, debug);
}

export function installMalware(ns: NS, serverName: string, debug = false) {
  if (
    ns.hasRootAccess(serverName) &&
    !ns.fileExists(CONFIG.malwareFile, serverName) &&
    !ns.fileExists(CONFIG.loopMalwareWeaken, serverName) &&
    !ns.fileExists(CONFIG.loopMalwareGrow, serverName) &&
    !ns.fileExists(CONFIG.loopMalwareHack, serverName)
  ) {
    ns.scp(CONFIG.malwareFile, serverName);
    ns.scp(CONFIG.loopMalwareWeaken, serverName);
    ns.scp(CONFIG.loopMalwareGrow, serverName);
    ns.scp(CONFIG.loopMalwareHack, serverName);
    log(ns, `Installed malware on: ${serverName}`, debug);
  }
}
